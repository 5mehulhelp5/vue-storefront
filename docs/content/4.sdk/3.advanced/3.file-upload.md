# File Upload

The SDK supports file uploads using `multipart/form-data` requests. This guide explains how to implement file uploads in your application using TypeScript.

## Basic Usage

To upload files using the SDK, you need to:

1. Prepare your file(s) as `File` or `Blob` objects
2. Configure the request with the correct content type
3. Call your upload endpoint using the SDK

Here's a basic example:

```typescript
const file = new File(["content"], "test.txt", { type: "text/plain" });

const response = await sdk.commerce.uploadFile(
  { file },
  prepareConfig({
    headers: {
      "Content-Type": "multipart/form-data",
    },
  })
);
```

## Multiple Files Upload

The SDK supports uploading multiple files in a single request:

```typescript
const files = [
  new File(["content1"], "file1.txt", { type: "text/plain" }),
  new File(["content2"], "file2.txt", { type: "text/plain" }),
];

const response = await sdk.commerce.uploadFile(
  { files },
  prepareConfig({
    headers: {
      "Content-Type": "multipart/form-data",
    },
  })
);
```

## Additional Parameters

The SDK allows you to send additional parameters along with your files. This is useful when you need to include metadata or other information with your upload:

```typescript
interface UploadParams {
  category: string;
  description: string;
  tags: string[];
}

const response = await sdk.commerce.uploadFile(
  {
    files, // Your file or files array
    metadata: {
      category: "products",
      description: "Product images batch upload",
      tags: ["products", "images"],
    },
    visibility: "public",
    expiresIn: "30d",
  },
  prepareConfig({
    headers: {
      "Content-Type": "multipart/form-data",
    },
  })
);
```

The SDK will automatically handle both the file data and additional parameters in the request. Here are some common use cases:

```typescript
// Single file with metadata
const response = await sdk.commerce.uploadFile(
  {
    file,
    category: "avatars",
    userId: "user123",
  },
  prepareConfig({
    headers: {
      "Content-Type": "multipart/form-data",
    },
  })
);

// Multiple files with shared parameters
const response = await sdk.commerce.uploadFile(
  {
    files: [file1, file2, file3],
    batchId: "batch123",
    processImmediately: true,
  },
  prepareConfig({
    headers: {
      "Content-Type": "multipart/form-data",
    },
  })
);
```

::tip
All additional parameters will be automatically included in the multipart/form-data request. You can include any serializable data alongside your files.
::

## Framework-Specific Examples

::tabs{:titles='["Next.js", "Nuxt.js"]'}
#tab-1

```typescript
// pages/api/upload.ts
import { NextApiRequest, NextApiResponse } from "next";
import { prepareConfig } from "@vue-storefront/sdk";

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse
) {
  if (req.method !== "POST") {
    return res.status(405).end();
  }

  try {
    const sdk = await getSdk();
    const formData = new FormData();

    if (req.files) {
      req.files.forEach((file: File) => {
        formData.append("files", file);
      });
    }

    const response = await sdk.commerce.uploadFile(
      { files: formData },
      prepareConfig({
        method: "POST",
        headers: {
          "Content-Type": "multipart/form-data",
        },
      })
    );

    res.status(200).json(response);
  } catch (error) {
    console.error("Upload failed:", error);
    res.status(500).json({ error: "Upload failed" });
  }
}
```

#tab-2

```typescript
// pages/upload.vue
<template>
  <div>
    <h1>Upload Files</h1>
    <input type="file" multiple @change="handleFileChange" />
    <button @click="uploadFiles">Upload</button>
    <p v-if="uploadStatus">{{ uploadStatus }}</p>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';
import { prepareConfig } from '@vue-storefront/sdk';

const selectedFiles = ref<File[]>([]);
const uploadStatus = ref<string | null>(null);

const handleFileChange = (event: Event) => {
  const target = event.target as HTMLInputElement;
  if (target.files) {
    selectedFiles.value = Array.from(target.files);
  }
};

const uploadFiles = async () => {
  if (!selectedFiles.value.length) return;

  try {
    const sdk = await useSdk();
    const formData = new FormData();

    selectedFiles.value.forEach((file) => {
      formData.append('files', file);
    });

    const response = await sdk.commerce.uploadFile(
      { files: formData },
      prepareConfig({
        method: 'POST',
        headers: {
          'Content-Type': 'multipart/form-data'
        }
      })
    );

    uploadStatus.value = 'Files uploaded successfully!';
  } catch (error) {
    console.error('Upload failed:', error);
    uploadStatus.value = 'An error occurred during upload.';
  }
};
</script>
```

::

## Usage with Middleware

::success
To read more about how to use file upload with the Middleware, please refer to the [File Upload Middleware Guide](https://docs.alokai.com/middleware/guides/file-upload).
::

## Important Notes

1. **Content Type**: Always set the `Content-Type` header to `multipart/form-data` for file uploads.

2. **File Objects**: The SDK automatically handles `File` and `Blob` objects in the request parameters.

3. **Request Configuration**: Use `prepareConfig()` to set the correct headers and method for your upload request.

4. **Error Handling**: Always implement proper error handling for upload operations as they can fail for various reasons (file size limits, network issues, etc.).
